rm(list = ls())

library(ggplot2)
library(grid)
library(cowplot)
library(zoo)
library(scales)

plot.mc <- function(d, limits, dates.for.plot) {
  p <- ggplot(data=d, aes(x=as.numeric(Date), y=y)) + geom_point() + 
    geom_errorbar(limits, width=10) + 
    xlab("Time") +
    ylab("Clock Rate") +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.6)) +
    scale_x_continuous(breaks = as.numeric(as.Date(c('03/31/2009',
                                                     '04/30/2009', 
                                                     '05/31/2009', 
                                                     '06/30/2009',
                                                     '07/31/2009',
                                                     '08/31/2009',
                                                     '09/30/2009',
                                                     '10/31/2009',
                                                     '11/30/2009',
                                                     '12/31/2009',
                                                     '01/31/2010',
                                                     '02/28/2010',
                                                     '03/31/2010',
                                                     '04/30/2010',
                                                     '05/31/2010',
                                                     '06/30/2010',
                                                     '07/31/2010',
                                                     '08/31/2010',
                                                     '09/30/2010',
                                                     '10/31/2010',
                                                     '11/30/2010',
                                                     '12/31/2010',
                                                     '01/31/2011',
                                                     '02/28/2011',
                                                     '03/31/2011',
                                                     '04/30/2011'), format='%m/%d/%Y')), 
                       labels = c('03/2009',
                                  '', 
                                  '', 
                                  '',
                                  '',
                                  '08/2009',
                                  '',
                                  '',
                                  '',
                                  '',
                                  '01/2010',
                                  '',
                                  '',
                                  '',
                                  '',
                                  '06/2010',
                                  '',
                                  '',
                                  '',
                                  '',
                                  '11/2010',
                                  '',
                                  '',
                                  '',
                                  '',
                                  '04/2011')) +
    scale_y_continuous(breaks = seq(0, 0.03, 0.005), limits = c(0, 0.027))
}

ds <- as.Date(c('04/30/2009', 
                '05/31/2009', 
                '06/30/2009',
                '07/31/2009',
                '08/31/2009',
                '09/30/2009',
                '10/31/2009',
                '11/30/2009',
                '12/31/2009',
                '01/31/2010',
                '06/30/2010',
                '11/30/2010',
                '04/30/2011'), format='%m/%d/%Y')

setwd('~/Desktop/')
na.d <- data.frame(Date=ds,
                   y=c(1.926e-2, 1.133e-2, 4.292e-3, 4.6e-3, 4.386e-3, 4.113e-3, 4.298e-3, 4.611e-3, 4.747e-3, 4.858e-3, 5.065e-3, 4.893e-3, 4.597e-3))

na.ci <- aes(ymax = c(2.66e-2, 1.41e-2, 7.0948e-3, 6.6281e-3, 6.1689e-3, 5.5538e-3, 5.6056e-3, 5.9508e-3, 5.9605e-3, 5.9108e-3, 5.9581e-3, 5.6122e-3, 5.1604e-3), 
             ymin = c(1.27e-2, 8.7037e-3, 4.1599e-7, 2.6317e-3, 2.8243e-3, 2.7876e-3, 3.0635e-3, 3.3842e-3, 3.702e-3, 3.8261e-3, 4.2444e-3, 4.1927e-3, 4.0285e-3))

p1 <- plot.mc(na.d, na.ci, ds)

ha.d <- data.frame(Date=ds,
                   y=c(1.598e-2, 1.1675e-2, 6.646e-3, 5.709e-3, 5.554e-3, 4.343e-3, 4.444e-3, 4.579e-3, 4.59e-3, 4.512e-3, 4.837e-3, 5.242e-3, 5.1862e-3))

ha.ci <- aes(ymax = c(2.21e-2, 1.42e-2, 1.02e-2, 8.2581e-3, 7.5397e-3, 5.6876e-3, 5.5197e-3, 5.504e-3, 5.3977e-3, 5.2322e-3, 5.489e-3, 5.8851e-3, 5.7354e-3), 
             ymin= c(1.07e-2, 9.02e-3, 1.6864e-6, 3.5334e-3, 3.7948e-3, 3.1081e-3, 3.4122e-3, 3.6445e-3, 3.8031e-3, 3.7901e-3, 4.1993e-3, 4.5871e-3, 4.6772e-3))

p2 <- plot.mc(ha.d, ha.ci, ds)

p <- ggdraw() +
  draw_plot(p2, 0, 0, 0.5, 1) +
  draw_plot(p1, 0.5, 0, .5, 1) +
  draw_plot_label(c("A", "B"), c(0, 0.5), c(1, 1), size = 16)

ggsave(p, file='clock_rate.pdf', height = 6, width = 12, useDingbats = F)